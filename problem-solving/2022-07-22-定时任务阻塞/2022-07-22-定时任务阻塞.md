**问题**

运维平台有很多中频和高频的定时任务，有些定时任务虽然设置的是整点执行，但执行时会延迟

![img](https://zalav54l6d.feishu.cn/space/api/box/stream/download/asynccode/?code=ZTNkOGU3NDhiMTEzMTZjOWU2MzAyNjczNWVmNDBlNjZfRzBib2hnNHhSelhpRUdjWUxmb0ZiWjdrMlVFWG5JYWVfVG9rZW46Rm5Td2I2aU9Ub2kyQU14R3dPWmNzdDJJbkliXzE3MDMwODM4MDc6MTcwMzA4NzQwN19WNA)

**定位**

没有为定时任务设置线程池，每个实例默认是单线程的

![img](https://zalav54l6d.feishu.cn/space/api/box/stream/download/asynccode/?code=YWZjOTkzNjJlZWQ5MTNjMDUxN2Y5MjA5ZjQ4ZGNiNTZfR1lJVjBJTWZEYW5FS1NSTjBjcm1uY2U2Q2o2Sm90QXBfVG9rZW46QmdXR2JLV05Mb1E0bGp4blVnbmMyMXJDblpnXzE3MDMwODM4MDc6MTcwMzA4NzQwN19WNA)

**方案**

import org.springframework.context.annotation.Configuration;

import org.springframework.scheduling.annotation.SchedulingConfigurer;

import org.springframework.scheduling.config.ScheduledTaskRegistrar;

import java.util.concurrent.ScheduledThreadPoolExecutor;

@Configuration

public class ScheduleConfig implements SchedulingConfigurer {

​    @Override

​    public void configureTasks(ScheduledTaskRegistrar taskRegistrar) {

​        ScheduledThreadPoolExecutor scheduledThreadPoolExecutor = new ScheduledThreadPoolExecutor(8);

​        scheduledThreadPoolExecutor.setMaximumPoolSize(20);

​        taskRegistrar.setScheduler(scheduledThreadPoolExecutor);

​    }

}

**结果**

可以准时执行了

![img](https://zalav54l6d.feishu.cn/space/api/box/stream/download/asynccode/?code=OWExOTlhNzQ3YjIzOTVlNzc5MmI1MWIzMTk2YTcwZDlfb2Q2alB5Z2dkd1ZhYjF3bHVGZEQ1YWZWY0xWNmI3YmdfVG9rZW46TTBGN2JzN0NEb1EzYWp4Q2dobWNRNlV2bkxOXzE3MDMwODM4MDc6MTcwMzA4NzQwN19WNA)

![img](https://zalav54l6d.feishu.cn/space/api/box/stream/download/asynccode/?code=MjM3YzNhZDdlOGNiODUzMzFkOTQ1YWYyZGM3YzdhY2NfTW9lT1pXTlZCR1BIMzRRZWlEbTdwdEoxOVhrc3JGSXhfVG9rZW46VkF6RGJaYUlwb1BYZUJ4MkpNV2NnU21QbmpiXzE3MDMwODM4MDc6MTcwMzA4NzQwN19WNA)